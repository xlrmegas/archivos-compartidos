<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Random Joke Generator</title>
  <style>
    :root {
      --bg: #0f1724;
      --card: #0b1020;
      --muted: #9aa4b2;
      --accent: #2dd4bf;
      --accent-2: #60a5fa;
      --glass: rgba(255,255,255,0.03);
    }
    html,body { height:100%; margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial; background:linear-gradient(180deg,var(--bg),#061021); color:#e6eef6; }
    .wrap { min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px; box-sizing:border-box; }
    .card {
      width:100%; max-width:720px; background:linear-gradient(180deg,var(--card),#071020);
      border-radius:12px; padding:28px; box-shadow: 0 10px 30px rgba(2,6,23,0.6);
      border: 1px solid rgba(255,255,255,0.03);
    }
    h1 { margin:0 0 6px 0; font-size:20px; letter-spacing:0.4px; color:var(--accent-2); }
    p.lead { margin:0 0 18px 0; color:var(--muted); font-size:14px; }
    .joke-area { background:var(--glass); border-radius:10px; padding:20px; min-height:120px; display:flex; flex-direction:column; justify-content:center; gap:10px; }
    .joke-text { font-size:18px; line-height:1.4; color:#eaf6ff; }
    .joke-meta { color:var(--muted); font-size:13px; display:flex; gap:10px; align-items:center; }
    .controls { margin-top:18px; display:flex; gap:10px; flex-wrap:wrap; }
    button {
      border:0; background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#042028; padding:10px 14px; border-radius:8px;
      cursor:pointer; font-weight:600; box-shadow: 0 6px 16px rgba(45,212,191,0.12);
    }
    button.ghost {
      background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.04);
      box-shadow:none; padding:8px 12px;
    }
    .small { padding:8px 10px; font-size:13px; }
    .muted { color:var(--muted); font-size:13px; }
    .loader { width:18px; height:18px; border-radius:50%; border:3px solid rgba(255,255,255,0.06); border-top-color:var(--accent); animation:spin 1s linear infinite; display:inline-block; vertical-align:middle; }
    @keyframes spin { to { transform:rotate(360deg); } }
    .center { display:flex; align-items:center; gap:8px; }
    .hidden { display:none; }
    footer { margin-top:16px; color:var(--muted); font-size:12px; text-align:right; }
    @media (max-width:560px) { .joke-text { font-size:16px; } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main" aria-labelledby="title">
      <h1 id="title">Random Joke Generator</h1>
      <p class="lead">Click the button to get a fresh joke from an external API. Uses icanhazdadjoke (JSON) with a fallback to Official Joke API.</p>

      <div class="joke-area" id="jokeArea" aria-live="polite">
        <div class="joke-text" id="jokeText">Press "Get Joke" to start — you'll get a short, random joke.</div>
        <div class="joke-meta" id="jokeMeta"></div>
      </div>

      <div class="controls">
        <button id="getBtn">Get Joke</button>
        <button id="anotherBtn" class="ghost small" disabled>Another</button>
        <button id="copyBtn" class="ghost small" disabled>Copy</button>
        <button id="shareBtn" class="ghost small" disabled>Share</button>
        <div style="flex:1"></div>
        <div class="muted center" id="status">Ready</div>
      </div>

      <footer>APIs: <a href="https://icanhazdadjoke.com/api" target="_blank" rel="noopener" style="color:var(--accent); text-decoration:none">icanhazdadjoke</a> + <a href="https://official-joke-api.appspot.com/" target="_blank" rel="noopener" style="color:var(--accent); text-decoration:none">Official Joke API</a></footer>
    </div>
  </div>

  <script>
    // Simple Random Joke Generator
    // Primary: https://icanhazdadjoke.com/ (requires Accept: application/json)
    // Fallback: https://official-joke-api.appspot.com/random_joke

    const getBtn = document.getElementById('getBtn');
    const anotherBtn = document.getElementById('anotherBtn');
    const copyBtn = document.getElementById('copyBtn');
    const shareBtn = document.getElementById('shareBtn');
    const jokeText = document.getElementById('jokeText');
    const jokeMeta = document.getElementById('jokeMeta');
    const status = document.getElementById('status');

    // show temporary status with optional loader
    function setStatus(text, {loading=false} = {}) {
      status.innerHTML = loading ? '<span class="loader" aria-hidden="true"></span> ' + text : text;
    }

    async function fetchIcanhaz() {
      const res = await fetch('https://icanhazdadjoke.com/', {
        headers: { Accept: 'application/json', 'User-Agent': 'Random-Joke-Generator (example)' }
      });
      if (!res.ok) throw new Error('icanhazdadjoke failed: ' + res.status);
      return res.json(); // { id, joke, status }
    }

    async function fetchOfficialJoke() {
      const res = await fetch('https://official-joke-api.appspot.com/random_joke');
      if (!res.ok) throw new Error('official-joke-api failed: ' + res.status);
      return res.json(); // {id, type, setup, punchline}
    }

    // returns {text, source}
    async function getJoke() {
      // Try primary
      try {
        const data = await fetchIcanhaz();
        return { text: data.joke, source: 'icanhazdadjoke' };
      } catch (e1) {
        console.warn('Primary API failed:', e1);
        // Fallback
        try {
          const d = await fetchOfficialJoke();
          return { text: d.setup + (d.punchline ? ' — ' + d.punchline : ''), source: 'official-joke-api' };
        } catch (e2) {
          console.error('Fallback API failed:', e2);
          throw new Error('Both joke APIs failed. Check your network or CORS policy.');
        }
      }
    }

    async function showJoke() {
      setStatus('Fetching joke...', { loading: true });
      getBtn.disabled = true;
      anotherBtn.disabled = true;
      copyBtn.disabled = true;
      shareBtn.disabled = true;

      try {
        const j = await getJoke();
        jokeText.textContent = j.text;
        jokeMeta.innerHTML = 'Source: <strong>' + j.source + '</strong>';
        setStatus('Joke loaded');
        // enable controls
        anotherBtn.disabled = false;
        copyBtn.disabled = false;
        shareBtn.disabled = !navigator.share; // only enable if Web Share API present
      } catch (err) {
        jokeText.textContent = 'Sorry — could not get a joke right now.';
        jokeMeta.textContent = '';
        setStatus('Error: ' + err.message);
      } finally {
        getBtn.disabled = false;
      }
    }

    // copy to clipboard
    async function copyJoke() {
      const text = jokeText.textContent;
      try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(text);
        } else {
          // fallback
          const ta = document.createElement('textarea');
          ta.value = text;
          document.body.appendChild(ta);
          ta.select();
          document.execCommand('copy');
          document.body.removeChild(ta);
        }
        setStatus('Copied to clipboard');
      } catch (e) {
        setStatus('Copy failed');
      }
    }

    // web share
    async function shareJoke() {
      if (!navigator.share) {
        setStatus('Web Share API not available');
        return;
      }
      try {
        await navigator.share({ title: 'Funny Joke', text: jokeText.textContent });
        setStatus('Shared');
      } catch (e) {
        setStatus('Share canceled');
      }
    }

    // event listeners
    getBtn.addEventListener('click', showJoke);
    anotherBtn.addEventListener('click', showJoke);
    copyBtn.addEventListener('click', copyJoke);
    shareBtn.addEventListener('click', shareJoke);

    // optional: fetch a joke automatically on page load
    // showJoke();
  </script>
</body>
</html>
